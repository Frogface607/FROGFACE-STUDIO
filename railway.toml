[build]
builder = "NIXPACKS"
buildCommand = "pnpm install --prod=false && echo '=== BUILDING PACKAGES ===' && (cd packages/core/api-client && pnpm build && echo '✅ api-client built') || echo '❌ api-client FAILED' && (cd packages/core/knowledge-base && pnpm install && pnpm build && echo '✅ knowledge-base built') || echo '❌ knowledge-base FAILED' && (cd packages/core/agent-base && pnpm install && pnpm build && echo '✅ agent-base built') || echo '❌ agent-base FAILED' && (cd packages/agents/copywriter && pnpm install && pnpm build && echo '✅ copywriter built') || echo '❌ copywriter FAILED' && (cd packages/agents/archivist && pnpm install && pnpm build && echo '✅ archivist built') || echo '❌ archivist FAILED' && (cd packages/agents/edison-copywriter && pnpm install && pnpm build && echo '✅ edison-copywriter built') || echo '❌ edison-copywriter FAILED' && (cd packages/core/mcp-server && pnpm install && echo '=== BUILDING mcp-server ===' && pnpm build && echo '=== AFTER BUILD ===' && ls -la dist/ && echo '=== CHECKING server.js ===' && test -f dist/server.js && echo '✅✅✅ server.js FOUND in dist! ✅✅✅' || (echo '❌ server.js NOT in dist!' && find . -name 'server.js' -type f)) || echo '❌ mcp-server FAILED' && cd /app && echo '=== FINAL CHECK ===' && ls -la packages/core/mcp-server/dist/ 2>&1"

[deploy]
startCommand = "cd /app && node packages/core/mcp-server/dist/server.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
