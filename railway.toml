[build]
builder = "NIXPACKS"
buildCommand = "pnpm install --prod=false && echo '=== BUILDING PACKAGES ===' && cd packages/core/api-client && pnpm build && echo '✅ api-client built' && cd ../knowledge-base && pnpm install && pnpm build && echo '✅ knowledge-base built' && cd ../agent-base && pnpm install && pnpm build && echo '✅ agent-base built' && cd ../../agents/copywriter && pnpm install && pnpm build && echo '✅ copywriter built' && cd ../archivist && pnpm install && pnpm build && echo '✅ archivist built' && cd ../edison-copywriter && pnpm install && pnpm build && echo '✅ edison-copywriter built' && cd ../../core/mcp-server && pnpm install && pnpm build && echo '✅ mcp-server built' && cd /app && echo '=== CHECKING DIST DIRS ===' && find packages -type d -name 'dist' && echo '=== MCP-SERVER DIST CONTENTS ===' && ls -la packages/core/mcp-server/dist/ && echo '=== CHECKING FOR server.js ===' && test -f packages/core/mcp-server/dist/server.js && echo '✅✅✅ server.js FOUND! ✅✅✅' || (echo '❌❌❌ server.js NOT FOUND! ❌❌❌' && echo '=== SEARCHING FOR server.js ===' && find packages -name 'server.js' -type f && echo '=== ALL .js FILES IN mcp-server ===' && find packages/core/mcp-server -name '*.js' -type f)"

[deploy]
startCommand = "cd /app && node packages/core/mcp-server/dist/server.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
