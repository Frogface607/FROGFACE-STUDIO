[build]
builder = "NIXPACKS"
buildCommand = "pnpm install --prod=false && echo '=== BUILDING IN DEPENDENCY ORDER ===' && echo '1/6 Building api-client...' && cd packages/core/api-client && pnpm build 2>&1 && echo '✅ api-client OK' && cd /app && echo '2/6 Building agent-base...' && cd packages/core/agent-base && pnpm install && pnpm build 2>&1 && echo '✅ agent-base OK' && cd /app && echo '3/6 Building knowledge-base...' && cd packages/core/knowledge-base && pnpm install && pnpm build 2>&1 && echo '✅ knowledge-base OK' && cd /app && echo '4/6 Building agents...' && cd packages/agents/copywriter && pnpm install && pnpm build 2>&1 && echo '✅ copywriter OK' && cd /app && cd packages/agents/archivist && pnpm install && pnpm build 2>&1 && echo '✅ archivist OK' && cd /app && cd packages/agents/edison-copywriter && pnpm install && pnpm build 2>&1 && echo '✅ edison-copywriter OK' && cd /app && echo '5/6 Building mcp-server...' && cd packages/core/mcp-server && pnpm install && pnpm build 2>&1 && echo '6/6 Checking build result...' && ls -la dist/ && echo '=== Looking for server.js ===' && (test -f dist/server.js && echo '✅✅✅ server.js EXISTS! ✅✅✅' || (echo '❌ server.js NOT FOUND!' && echo 'Files in dist:' && find dist -type f))) && cd /app && echo '=== FINAL VERIFICATION ===' && test -f packages/core/mcp-server/dist/server.js && echo '✅✅✅ READY TO DEPLOY! ✅✅✅' || echo '❌❌❌ BUILD FAILED! ❌❌❌'"

[deploy]
startCommand = "cd /app && node packages/core/mcp-server/dist/server.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
